<!doctype html>

<html>

<head>
	<title>Campaign Creator - Step 2</title>

	<script src="https://code.jquery.com/jquery-2.0.3.min.js"></script>
	
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">	
	
	<!-- Import quesType definitions -->
	<script src="quesTypeUpdated.js"></script>
	
	<script src="cytoscape.js"></script>
	
	<style type="text/css">
	body 
	{
		  font-family: helvetica;
		  font-size: 14px;
	}

	#cy 
	{
		  border: solid;
		  border-width: 1;
		  height: 500px;
	}

	h1 
	{
		  opacity: 0.5;
		  font-size: 1em;
	}

	.button_custom_color 
	{
   		  background-color:  #4c8dc7  !important;
	}
	</style>
	
	<script type="text/javascript">
	
	$( document ).ready(function() {
		
		const FreeTextSingle_const = 'FreeTextSingle';
		const FreeTextMulti_const = 'FreeTextMulti';
		const MultipleChoiceSingle_const = 'MultipleChoiceSingle';
		const MultipleChoiceMulti_const = 'MultipleChoiceMulti';
		const ContRange_const = 'ContRange';
		const AudioSensor_const = 'AudioSensor';
		const TextDisplay_const = 'TextDisplay';
		const FreeNumericSingle_const        = 'FreeNumericSingle';

		
		var config = JSON.parse(sessionStorage.campaign);
		console.log('Campaign config is ' + JSON.stringify(config));
		
		var Campaign_ID               = config.Campaign_ID;
		var Campaign_Description      = config.Campaign_Description;
		var onetimeValue              = config.onetime;
		var expiry                    = config.expiry;
		var start_date                = config.startDate;
		var end_date                  = config.endDate;
		var StartQues                 = config.startQuestion;
		var Question_Array = [];
		var Campaign_Workflow = [];
		var geoBoolean                = config.geoBoolean;
		var PoI = [];
		var question_number = 1;
		var subcomponent_count = 0;
		var geo_component = 0;	
		var ID_of_edited_question = '';	
		var userID                    = sessionStorage.getItem('username');
		console.log('UserID is ' + userID);
		
		var nodeSequence = [];

		
		var cyto_config = JSON.stringify(config.cytoscape);
		
		//--------------initial print
		console.log('-------------Initial print--------------');
		console.log('Cam ID is ' + Campaign_ID);
		console.log('Cam description is ' + Campaign_Description);
		console.log('expiry value is ' + expiry);
		console.log('start date is ' + start_date);
		console.log('end date is ' + end_date);
		console.log('start ques is ' + StartQues);
		console.log('geoBoolean is ' + geoBoolean);
		console.log('cyto_config is ' + cyto_config);
		
		$('[data-toggle="FreeTextSingle-tooltip"]').tooltip(); 
		$('[data-toggle="FreeTextMulti-tooltip"]').tooltip();
		$('[data-toggle="MultipleChoiceSingle-tooltip"]').tooltip();
		$('[data-toggle="MultipleChoiceMulti-tooltip"]').tooltip();
		$('[data-toggle="AudioSensor-tooltip"]').tooltip();	
		$('[data-toggle="TextDisplay-tooltip"]').tooltip();
		
		for (var i=0; i < config.Question_Array.length; i++)
		{
			if (config.Question_Array[i].quesType == FreeTextSingle_const)
				{
				var FreeTextSingle_obj         = new FreeTextSingle('','',[]);
					FreeTextSingle_obj.deserialize(config.Question_Array[i]);
					Question_Array.push(FreeTextSingle_obj);
				}
			else if (config.Question_Array[i].quesType == FreeTextMulti_const)
			{
				var FreeTextMulti_obj          = new FreeTextMulti('','',[],[]);
				FreeTextMulti_obj.deserialize(config.Question_Array[i]);
				Question_Array.push(FreeTextMulti_obj);
			}
			else if (config.Question_Array[i].quesType == MultipleChoiceSingle_const)
			{
				var MultipleChoiceSingle_obj   = new MultipleChoiceSingle('','',[],[]);
				MultipleChoiceSingle_obj.deserialize(config.Question_Array[i]);
				Question_Array.push(MultipleChoiceSingle_obj);
			}
			else if (config.Question_Array[i].quesType == MultipleChoiceMulti_const)
			{
				var MultipleChoiceMulti_obj    = new MultipleChoiceMulti('','',[],[]);
				MultipleChoiceMulti_obj.deserialize(config.Question_Array[i]);
				Question_Array.push(MultipleChoiceMulti_obj);
			}
			else if (config.Question_Array[i].quesType == AudioSensor_const)
			{
				var AudioSensor_obj            = new AudioSensor('','',[]);
				AudioSensor_obj.deserialize(config.Question_Array[i]);
				Question_Array.push(AudioSensor_obj);
			}
			else if (config.Question_Array[i].quesType == TextDisplay_const)
			{
				var TextDisplay_obj            = new TextDisplay('','',[]);
				TextDisplay_obj.deserialize(config.Question_Array[i]);
				Question_Array.push(TextDisplay_obj);				
			}
			else if (config.Question_Array[i].quesType == FreeNumericSingle_const)
			{
				var FreeNumericSingle_obj            = new FreeNumericSingle('','',[]);
				FreeNumericSingle_obj.deserialize(config.Question_Array[i]);
				Question_Array.push(FreeNumericSingle_obj);				
			}
			else if (config.Question_Array[i].quesType == ContRange_const)
			{
				var ContRange_obj            = new ContRange('','',[],[]);
				ContRange_obj.deserialize(config.Question_Array[i]);
				Question_Array.push(ContRange_obj);				
			}
			
			
		}
		console.log('Size of the questionArray is ' + Question_Array.length);
	console.log('Content of the questionArray is ' + JSON.stringify(Question_Array));
		
		var flow_obj = config.workflow;
		
		for (var i = 0;i < flow_obj.length; i++)
		{
			var condition_array = [];
			for (var j = 0;j< flow_obj[i].Condition.length;j++)
				{
					var branch = new Branch('','');
					branch.deserialize(flow_obj[i].Condition[j]);
					console.log(branch.getExpression());
					console.log(branch.getNext());
					condition_array.push(branch);
					console.log('Content of condition_array ' + JSON.stringify(condition_array));
				}
			var wf_elem = new Workflow_Element(flow_obj[i].QuesID,condition_array);
			Campaign_Workflow.push(wf_elem);
			console.log('SIZE OF array_flow is ' + Campaign_Workflow.length);		
		}
		console.log('-----------------------------');		
		
		console.log(JSON.stringify(Campaign_Workflow));
		
		//-----------------------------------------
		var list_PoI = config.PoI_list;				
		console.log('Size of campaign PoI_list is ' + list_PoI.length);
		
		var list_PoI_WebMercator = config.PoI_list_WebMercator;
		console.log('Size of the PoI_list_webMercator is ' + list_PoI_WebMercator.length);
		
		console.log('----------------FInal check-----------------');
		console.log(config.Campaign_ID);
		console.log(config.userID);
		console.log(JSON.stringify(Question_Array));
		console.log(JSON.stringify(Campaign_Workflow));
		console.log(JSON.stringify(list_PoI));
		console.log(JSON.stringify(list_PoI_WebMercator));
		
		// Show/hide the parameter of the conditional transition
		$("input[name='primitive']").click(function () {
	    $('#value_0').css('display', ($(this).val() === 'value') ? 'block':'none');
	    $('#values_0').css('display', ($(this).val() === 'values') ? 'block':'none');
	    $('#count_0').css('display', ($(this).val() === 'count') ? 'block':'none');
		});
		
		var cy = window.cy = cytoscape({
		    container: document.getElementById('cy'),

		    zoom: 1.5,
			wheelSensitivity: 0.05,
			minZoom: 1,
		    maxZoom: 20,

		    // panningEnabled: false,
		    //boxSelectionEnabled: true,
		    //autounselectify: false,
		    //selectionType: 'additive',
		    //autoungrabify: true,		    

		    style: [{
                selector: 'node',
                style: {                          
                    label: 'data(id)',
                    "text-valign":"center",
                    "text-halign":"center",
                }
            },{
                selector: 'node.highlight',
                style: {
                    'border-color': 'red',
                    'border-width': '4px'
                }
            },{
                selector: 'node.normal',
                style: {
              	  label: 'data(id)',
                    "text-valign":"center",
                    "text-halign":"center"
                }
            },

            {
				selector: 'edge',
				style: {
					'width': 2,
					'target-arrow-shape': 'triangle',
					'line-color': '#9dbaea',
					'target-arrow-color': '#9dbaea',
					'curve-style': 'bezier'
				}
			},{
				selector: 'edge.highlight',
				style: {
					'width': 3,
					'target-arrow-shape': 'triangle',
					'line-color': 'green',
					'target-arrow-color': '#9dbaea',
					'curve-style': 'bezier'
				}
			} 		      
		    ],

		    elements: {
		      //selectable: false, 
		      grabbable: false,
		      nodes: [], // nodes
		      edges: [] // edges
		    } // elements
		  }); // cytoscape
		  
		cy.resize();		  
		
		var JsonObject = config.cytoscape;
		
		var nodenumber = JsonObject.elements.nodes.length;
		var edgenumber = JsonObject.elements.edges.length;
		
		for (var i=0;i<nodenumber;i++)
			{
				cy.add({
				    group: "nodes",
				    data: { id: JsonObject.elements.nodes[i].data.id },
				    position: { x: JsonObject.elements.nodes[i].position.x , y: JsonObject.elements.nodes[i].position.y  },
				    classes: JsonObject.elements.nodes[i].classes,
				});					
			}
		
		for (var i=0;i<edgenumber;i++)
			{		
				cy.add({
			  	    group: "edges",
			  	    data: { id: JsonObject.elements.edges[i].data.id, 
			  	    	source: JsonObject.elements.edges[i].data.source, 
			  	    	target: JsonObject.elements.edges[i].data.target }
			  	});		
			}
		
		//---------------------------------------------------Hover on NODE
	    cy.on('mousemove','node', function(event){
	        var node = event.cyTarget;
	        var sourceName = node.id();        
	        
	        var content = '';
	        var questionType = '';
	        
	        for (var i=0;i<Question_Array.length;i++)
	      	  {
	      	  	if (Question_Array[i].getID() == sourceName)
	      	  		{
			      	  	content = Question_Array[i].getLabel()[0];
			      	  	questionType = Question_Array[i].getType();	      	  		
	      	  		}	      	  		
	      	  }
	        $('#' + sourceName).remove();
	        $('<div id="' + sourceName + '"> This question is: ' + content + ' , of type ' + questionType + '</div>').appendTo("#cy");        

	        var x=event.cyPosition.x + $(window).width()/2 ;
	        var y=event.cyPosition.y;            
	            
	});
	    cy.on('mouseout','node', function(event){
	  	  var node = event.cyTarget;
	        var sourceName = node.id();
	        
				var content = '';
	        
	        for (var i=0;i<Question_Array.length;i++)
	      	  {
	      	  	if (Question_Array[i].getID() == sourceName)
	      	  		content = Question_Array[i].getLabel()[0];
	      	  }
	        
	      $('#' + sourceName).remove();
	  	  
	    });
	    
	    $('.begin_step2').hide();
	    
	  //-----------------------------------------------Click on NODE
		cy.on('click', 'node', { foo: 'bar' }, function(evt){
			  console.log( evt.data.foo ); // 'bar'
			  
			  //$('#edit_node').show();
			  
			  $('.edit_form').hide();
			  $('#display_hide').show();
			  
			  $('.subcomponent').remove();

			  var node = evt.cyTarget;
			  console.log( 'tapped ' + node.id() );
			  
			  ID_of_edited_question = node.id();
			  
			  var question =  null;
				for (var i=0;i<Question_Array.length;i++)
					  {
					  	if (Question_Array[i].getID() === ID_of_edited_question) 
					  		{    		  		
					  			question = Question_Array[i];    		  		
					  		}   		  	
					  }
				  console.log(question.getID() + ' ' + question.getType());
				  
				  if (question.getType() == FreeTextSingle_const)
				  {
				  	$('#display_hide').hide();
				  	$('#FreeTextSingle_Form').show();
				  	
				  	$('#FreeTextSingle_Form_QuesText').val(  question.getLabel()[0]   );
				  	$('#FreeTextSingle_Form_QuesImage').val( question.getLabel()[1]   );
				  	$('#FreeTextSingle_Form_QuesAudio').val( question.getLabel()[2]   );
				  	
				  }
			  else if (question.getType() == FreeTextMulti_const)
				  {			  	
				  	var subcomponent_array = [];
				  	var size = question.getSubcomponent().length;
				  	subcomponent_count = size;
				  	console.log('The size of subcomponent is ' + size);
				  	console.log('The current question selected to be edited is ' + ID_of_edited_question);
				  	
				  	$('#display_hide').hide();
				  	$('#FreeTextMulti_Form').show();
				  	
				  	$('#FreeTextMulti_Form_QuesText').val(  question.getLabel()[0]   );
				  	$('#FreeTextMulti_Form_QuesImage').val( question.getLabel()[1]   );
				  	$('#FreeTextMulti_Form_QuesAudio').val( question.getLabel()[2]   );   	
				  	
				  	
				  	for (var i=0;i< size;i++)
				  		{
				  			//Add a new div
							$('<div id="' + ID_of_edited_question + '_subcomponent_div' + i + '" class = "subcomponent_FreeTextMulti hover_action subcomponent" </div>').appendTo("#FreeTextMulti_innerForm");
						
							//Add text "Sub-Component" to the newly-created div
							$('<p id ="' + ID_of_edited_question + '_subcomponent_text_' + i + '" class = "subcomponent_FreeTextMulti">').text('Sub-Component').appendTo("#" + ID_of_edited_question + '_subcomponent_div' + i);
							
							//Add textfield to the newly-created div
							$('<input type="text" class = "subcomponent_FreeTextMulti" id="' + ID_of_edited_question + '_subcomponent_' + i + '"></input>' ).appendTo("#" + ID_of_edited_question + '_subcomponent_div' + i);
							$('#' + ID_of_edited_question + '_subcomponent_' + i).val( question.getSubcomponent()[i] );
							
							//Add REMOVE button to the newly-created div
							$('<button id="Delete_subcomponent_' + i + '" type="button" class="btn btn-danger" style="display: none;"> <span class="glyphicon glyphicon-remove-sign"></span> Remove </button>')
							.click(function(){
								
								var thisButton_ID = $(this).attr('id');
								console.log(thisButton_ID);
								var subcomponent_index = thisButton_ID.substring(thisButton_ID.lastIndexOf('_')+1, thisButton_ID.length );
								console.log(subcomponent_index);
								$('#' + ID_of_edited_question + '_subcomponent_div' + subcomponent_index).remove();
								//subcomponent_count--;
											              
					            })
							.appendTo("#" + ID_of_edited_question + '_subcomponent_div' + i);
				  			
				  		}
				  	    		  	
				  
				  }
			  else if (question.getType() == MultipleChoiceSingle_const)
				  {
				  	var subcomponent_array = [];
				  	var size = question.getSubcomponent().length;
				  	subcomponent_count = size;
				  	console.log('The size of subcomponent is ' + size);
				  	console.log('The current question selected to be edited is ' + ID_of_edited_question);
				  	
				  	
				  	$('#MultipleChoiceSingle_Form').show();
				  	
				  	$('#MultipleChoiceSingle_Form_QuesText').val(  question.getLabel()[0]   );
				  	$('#MultipleChoiceSingle_Form_QuesImage').val( question.getLabel()[1]   );
				  	$('#MultipleChoiceSingle_Form_QuesAudio').val( question.getLabel()[2]   );   	
				  	
				  	
				  	for (var i=0;i< size;i++)
				  		{
				  			//Add a new div
							$('<div id="' + ID_of_edited_question + '_subcomponent_div' + i + '" class = "subcomponent_MultipleChoiceSingle hover_action subcomponent" </div>').appendTo("#MultipleChoiceSingle_innerForm");
						
							//Add text "Sub-Component" to the newly-created div
							$('<p id ="' + ID_of_edited_question + '_subcomponent_text_' + i + '" class = "subcomponent_MultipleChoiceSingle">').text('Sub-Component').appendTo("#" + ID_of_edited_question + '_subcomponent_div' + i);
							
							//Add textfield to the newly-created div
							$('<input type="text" class = "subcomponent_MultipleChoiceSingle" id="' + ID_of_edited_question + '_subcomponent_' + i + '"></input>' ).appendTo("#" + ID_of_edited_question + '_subcomponent_div' + i);
							$('#' + ID_of_edited_question + '_subcomponent_' + i).val( question.getSubcomponent()[i] );
							
							//Add REMOVE button to the newly-created div
							$('<button id="Delete_subcomponent_' + i + '" type="button" class="btn btn-danger" style="display: none;"> <span class="glyphicon glyphicon-remove-sign"></span> Remove </button>')
							.click(function(){
								
								var thisButton_ID = $(this).attr('id');
								console.log(thisButton_ID);
								var subcomponent_index = thisButton_ID.substring(thisButton_ID.lastIndexOf('_')+1, thisButton_ID.length );
								console.log(subcomponent_index);
								$('#' + ID_of_edited_question + '_subcomponent_div' + subcomponent_index).remove();
								//subcomponent_count--;
											              
					            })
							.appendTo("#" + ID_of_edited_question + '_subcomponent_div' + i);
				  			
				  		}
				  
				  }
			  else if (question.getType() == MultipleChoiceMulti_const)
				  {
						  var subcomponent_array = [];
						  	var size = question.getSubcomponent().length;
						  	subcomponent_count = size;
						  	console.log('The size of subcomponent is ' + size);
						  	console.log('The current question selected to be edited is ' + ID_of_edited_question);
						  	
						  	
						  	$('#MultipleChoiceMulti_Form').show();
						  	
						  	$('#MultipleChoiceMulti_Form_QuesText').val(  question.getLabel()[0]   );
						  	$('#MultipleChoiceMulti_Form_QuesImage').val( question.getLabel()[1]   );
						  	$('#MultipleChoiceMulti_Form_QuesAudio').val( question.getLabel()[2]   );   	
						  	
						  	
						  	for (var i=0;i< size;i++)
						  		{
						  			//Add a new div
									$('<div id="' + ID_of_edited_question + '_subcomponent_div' + i + '" class = "subcomponent_MultipleChoiceMulti hover_action subcomponent" </div>').appendTo("#MultipleChoiceMulti_innerForm");
								
									//Add text "Sub-Component" to the newly-created div
									$('<p id ="' + ID_of_edited_question + '_subcomponent_text_' + i + '" class = "subcomponent_MultipleChoiceMulti">').text('Sub-Component').appendTo("#" + ID_of_edited_question + '_subcomponent_div' + i);
									
									//Add textfield to the newly-created div
									$('<input type="text" class = "subcomponent_MultipleChoiceMulti" id="' + ID_of_edited_question + '_subcomponent_' + i + '"></input>' ).appendTo("#" + ID_of_edited_question + '_subcomponent_div' + i);
									$('#' + ID_of_edited_question + '_subcomponent_' + i).val( question.getSubcomponent()[i] );
									
									//Add REMOVE button to the newly-created div
									$('<button id="Delete_subcomponent_' + i + '" type="button" class="btn btn-danger" style="display: none;"> <span class="glyphicon glyphicon-remove-sign"></span> Remove </button>')
									.click(function(){
										
										var thisButton_ID = $(this).attr('id');
										console.log(thisButton_ID);
										var subcomponent_index = thisButton_ID.substring(thisButton_ID.lastIndexOf('_')+1, thisButton_ID.length );
										console.log(subcomponent_index);
										$('#' + ID_of_edited_question + '_subcomponent_div' + subcomponent_index).remove();
										//subcomponent_count--;
													              
							            })
									.appendTo("#" + ID_of_edited_question + '_subcomponent_div' + i);
						  			
						  		}			  
				  }
			  else if (question.getType() == AudioSensor_const)
			  		{
						  	$('#display_hide').hide();
						  	$('#AudioSensor_Form').show();
					  	
					  		$('#AudioSensor_Form_QuesText').val(  question.getLabel()[0]   );
					  		$('#AudioSensor_Form_QuesImage').val( question.getLabel()[1]   );	  
			 		}	
			  else if (question.getType() == TextDisplay_const)
			  {
						  	$('#display_hide').hide();
						  	$('#TextDisplay_Form').show();
						  	
						  	$('#TextDisplay_Form_QuesText').val(  question.getLabel()[0]   );
						  	$('#TextDisplay_Form_QuesImage').val( question.getLabel()[1]   );
						  	$('#TextDisplay_Form_QuesAudio').val( question.getLabel()[2]   );
				  	
				  }
			  else if (question.getType() == FreeNumericSingle_const)
				  {
				  	$('#display_hide').hide();
				  	$('#FreeNumericSingle_Form').show();
				  	
				  	$('#FreeNumericSingle_Form_QuesText').val(  question.getLabel()[0]   );
				  	$('#FreeNumericSingle_Form_QuesImage').val( question.getLabel()[1]   );
				  	$('#FreeNumericSingle_Form_QuesAudio').val( question.getLabel()[2]   );
				  	
				  }
			  else if (question.getType() == ContRange_const)
			  {
				  	$('#display_hide').hide();
				  	$('#ContRange_Form').show();
				  	
				  	$('#ContRange_Form_QuesText').val(  question.getLabel()[0]   );
				  	$('#ContRange_Form_QuesImage').val( question.getLabel()[1]   );
				  	$('#ContRange_Form_QuesAudio').val( question.getLabel()[2]   );
				  	
				  	$('#ContRange_min').val (question.getSubcomponent()[0]);
				  	$('#ContRange_max').val (question.getSubcomponent()[1]);
				  	
				  }
			  
			  $('#selection').val(node.id());
			  
			  question = null;
			  
			  
			});
	  
		//-----------------------------------------------Click on EDGE
		cy.on('tap', 'edge', { foo: 'khoi' }, function(evt){
			  //console.log( evt.data.foo ); // 'khoi'
		
			  var edge = evt.cyTarget;
			  console.log( 'edge ' + edge.id() );
			  $('#selection').val(edge.id());
			  
			  var this_edge = cy.$('#' + edge.id());
			  var source = this_edge.source();
			  var target = this_edge.target();
			  console.log(source.id() + ' -------> ' + target.id());
			});
		
		function getNodePositionX()
	    {
	    	if (nodeSequence.length == 0)
	    		return (cy.$('#' + StartQues).position('x') + 20);
	    	else
	    		{
		    		var lastNode = nodeSequence[nodeSequence.length-1];
			    	var positionX = cy.$('#' + lastNode).position('x');		  
			    	return positionX;		    		
	    		}		    	
	    }
	    function getNodePositionY()
	    {
	    	if (nodeSequence.length == 0)
	    		return (cy.$('#' + StartQues).position('y') + 20);
	    	else
	    		{
		    		var lastNode = nodeSequence[nodeSequence.length-1];
			    	var positionY = cy.$('#' + lastNode).position('y');		  
			    	return positionY;		    			
	    		}		    	
	    }
	  
	  	//----------------------Hover on div to show Button
		$(document).on('mouseenter', '.hover_action', function () {
			
			//var divID = $(this).attr('id');
			//console.log(divID);
			
		    $(this).find(":button").show(); 	    
		    
		}).on('mouseleave', '.hover_action', function () {
		    $(this).find(":button").hide();
		    //$( ".hover_action" ).off();
		});
	  	
		//-------------------------------------------New DELETE button, without typing the ID of the node to be deleted
		$('#new_delete').on('click', function(e) {
		var itemID = $('#selection').val();
			console.log('ID to be deleted is ' + itemID);
			
			//select that item from the graph
			var a = cy.$("#" + itemID);
			  	
			  	
			  	if (a.isNode()) {  	  		
			  		console.log('This is a node');
			  		var this_node = cy.$('#' + itemID);
			  		var incomers = this_node.incomers();
				console.log('Number of incomers is ' + incomers.length);
				for (var i=0;i<incomers.length;i++)
				{
				
				console.log('aaaaaaaaaaaaaaaaaaaaaaaaa');
				for (var i=0;i<incomers.length;i++)
					{
						if (incomers[i].isNode())
							{
								var ID = incomers[i].id();
								for (var j=0;j<Campaign_Workflow.length;j++)
									{
										if (Campaign_Workflow[j].getQuesID() == ID)
											{
												var workflow_element = Campaign_Workflow[j];
												var condition = workflow_element.getCondition();
												for (var k=0;k<condition.length;k++)
													{
														if (condition[k].getNext() == itemID)
															{
															console.log('Found the following branch: '+ condition[k].getExpression() + ', ' + condition[k].getNext()  );
															condition.splice(k,1);
															}
													}
											}
									}
							}
					}			
				}  	  		
			  	}
			  	
			  	if (a.isEdge()) {
			  		console.log('This is an edge');  	  		
			  		
			  		var this_edge = cy.$('#' + itemID);
			 		var source = this_edge.source();
			  		var target = this_edge.target();  	  		
		  		console.log('This edge ' + this_edge.id() + ' is from ' + source.id() + ' to ' + target.id() );  	
		  		
		  		for (var i=0;i<Campaign_Workflow.length;i++)
		  			{
		  				if (Campaign_Workflow[i].getQuesID() == source.id())
		  					{
									var workflow_element = Campaign_Workflow[i];
									var condition = workflow_element.getCondition();
		  						for (var j=0;j<condition.length;j++)
		  							{
		  								if (condition[j].getNext() == target.id())
		  									{
		  										console.log('Found the following branch: '+ condition[j].getExpression() + ', ' + condition[j].getNext()  );
		  										condition.splice(j,1);
		  									}	  								
		  							}
		  					}
		  			}
			  	}
			  	
			  	//remove question from Question_Array
			  	for (var j=0;j<Question_Array.length;j++)
			{
				if (Question_Array[j].getID() === itemID)
					{
						console.log(itemID + ' found in Question_Array, deleted');
						Question_Array.splice(j,1);	    				
					}	    				
			}	
			  	
			  	//remove entry from the workflow array
			  	for (var j=0;j<Campaign_Workflow.length;j++)
			{
				if (Campaign_Workflow[j].getQuesID() === itemID)
					{
						console.log(itemID + ' found in Worlflow_Array, deleted');
						Campaign_Workflow.splice(j,1);	    				
					}	    				
			} 	  	
			  	
			  	//reset textfield
			  	$('#delete_node_textfield').val('');
			  	
			  	cy.remove( a );
			  	$('.edit_form').hide();
			  	
			  	if (itemID == StartQues)
				{
					StartQues = '';
					console.log('Question deleted is also StartQues');
				}
			  	
			  	ID_of_edited_question = '';
			  	
			  //reset text fields
				$('.FreeTextSingle_input').val('');
				$('.FreeTextMulti_input').val('');
				$('.MultipleChoiceSingle_input').val('');
				$('.MultipleChoiceMulti_input').val('');
				$('.AudioSensor_input').val('');
				$('.TextDisplay_input').val('');
				$('.FreeNumericSingle_input').val('');
				$('.ContRange_input').val('');
				
				//remove subcomponent from question form
				$('.subcomponent').remove();
			
		});
		
		//---------------------------------Select the start question
		$('#new_selectStart').on('click', function(e) {
			var found = false;
			
			if (StartQues != '')
				{
					var b = cy.$('#' + StartQues);
					b.removeClass('highlight');
				
				}		
					var value = $('#selection').val();
					for (var i = 0;i<Question_Array.length;i++)
						{
							if (Question_Array[i].getID() == value)	
								{
									found = true;
								}
						}
					
					if (found == true)
						{
							StartQues = value;
							var a = cy.$("#" + StartQues);	
							a.addClass('highlight');
						}
					else 
						{
							alert('Incorrect input for start question');
						}						
		  	  		
					//reset textfield
					$('#start-question_textfield').val('');		
		});
		
		function check_duplicate_quesID(number) 
		{
			var ID = "Q" + number;
			var duplicate = false;
			
			for (var i=0;i<Question_Array.length;i++)
				{
					if (Question_Array[i].getID()==ID)
						{
							console.log(ID + ' already existed');
							duplicate = true;
						}
				}
			ID = "T" + number;
			for (var i=0;i<Question_Array.length;i++)
			{
				if (Question_Array[i].getID()==ID)
					{
						console.log(ID + ' already existed');
						duplicate = true;
					}
			}		
			return duplicate;		
		}
		
		function addNode(questionID)
		    {
		    	cy.add({
	        	 	   group: "nodes",
	        	  	  data: { id: questionID },
	        		    //position: { x: question_number * 20 , y: question_number * 20  }
	        	  		position: { x: getNodePositionX() + 30 , y: getNodePositionY() + 30  }
	      		 	});   		    	
		    }
		    
		    function addDefaultTransition(questionID)
		    {
		    	//Add the default transition ("end transition") to the question just created
     	 		var blank_condition = [];
     	 		var temp_WorkflowElement = new Workflow_Element(questionID,blank_condition);
    			Campaign_Workflow.push(temp_WorkflowElement); 		    	
		    }
		
		//---------------------------------FreeTextSingle-----------------------------------
		$('#FreeTextSingle').on('click', function(e) {
			$('.question').hide();
			$('.quesTrans').hide();
			$('#FreeTextSingle_Form').show();
			$("#display_hide").hide();
		});

		$('#FreeTextSingle_Cancel').on('click', function(e) {
			
			//reset text fields
			$('.FreeTextSingle_input').val('');
			//hide the form
			$('#FreeTextSingle_Form').hide();
			$("#display_hide").show();
			$('#edit_node').hide();
			
			ID_of_edited_question = '';		
		});	

		$('#FreeTextSingle_Save').on('click', function(e) {
			
			//A new FreeTextSingle is created
			if (ID_of_edited_question == '')
				{
					var quesID = "Q" + question_number;
					
					while( check_duplicate_quesID(question_number) == true )
					{
						question_number++;
						quesID = "Q" + question_number;
						console.log('Try with ' + quesID);					
					}
					console.log('Finally quesID is ' + quesID);
					
					question_number++;
					var quesType = FreeTextSingle_const;
					var quesLabel = [$('#FreeTextSingle_Form_QuesText').val(),$('#FreeTextSingle_Form_QuesImage').val(),$('#FreeTextSingle_Form_QuesAudio').val()];
					var temp = new FreeTextSingle(quesID, quesType, quesLabel);
					Question_Array.push(temp);		
				
					/*
					//Visually add the node(by default it is disconnected) to the graph
		  			cy.add({
		    	 	   group: "nodes",
		    	  	  data: { id: quesID },
		    	  		position: { x: getNodePositionX() + 30 , y: getNodePositionY() + 30  }
		  		 	});
					*/
					
					addNode(quesID);
		    		addDefaultTransition(quesID);
		  		
					/*
					//Add the default transition ("end transition") to the question just created
		 	 		var blank_condition = [];
		 	 		var temp_WorkflowElement = new Workflow_Element(quesID,blank_condition);
					Campaign_Workflow.push(temp_WorkflowElement); 
					*/
		  		
		 	 		//reset text fields
					$('.FreeTextSingle_input').val('');		
					//hide the form
					$('#FreeTextSingle_Form').hide();
					$("#display_hide").show();	
					nodeSequence.push(quesID);
					console.log('The nodeSequence is ' + JSON.stringify(nodeSequence));
				}
			
			//A FreeTextSingle is being edited, 
			else 
				{
					for (var i=0;i<Question_Array.length;i++)
						{
							if (Question_Array[i].getID()  == ID_of_edited_question)
								{
									console.log("Question found, data is " + Question_Array[i].getID() + ' ' + Question_Array[i].getLabel());
									Question_Array.splice(i,1);
								}
						}
					var quesID = ID_of_edited_question;
					var quesType = FreeTextSingle_const;
					var quesLabel = [$('#FreeTextSingle_Form_QuesText').val(),$('#FreeTextSingle_Form_QuesImage').val(),$('#FreeTextSingle_Form_QuesAudio').val()];
					var temp = new FreeTextSingle(quesID, quesType, quesLabel);
					Question_Array.push(temp);
					
					ID_of_edited_question = '';
					
					//reset text fields
					$('.FreeTextSingle_input').val('');		
					//hide the form
					$('#FreeTextSingle_Form').hide();
					$("#display_hide").show();				
				}
			
			$('#edit_node').hide();
		});
		
		//-----------------------------------FreeTextMulti---------------------------------
		$('#FreeTextMulti').on('click', function(e) {	
			console.log('question_number is ' + question_number);
			$('.question').hide();
			$('.quesTrans').hide();
			$('#FreeTextMulti_Form').show();
			$("#display_hide").hide();
		});

		$('#FreeTextMulti_Cancel').on('click', function(e) {
			
			//reset text fields
			$('.FreeTextMulti_input').val('');
			//hide the form
			$('#FreeTextMulti_Form').hide();
			$("#display_hide").show();
			
			ID_of_edited_question = '';
			
			$('.subcomponent_FreeTextMulti').remove();
			$('#edit_node').hide();
		});

		$('#FreeTextMulti_Save').on('click', function(e) {
			console.log('question_number is ' + question_number);
			
			// A new FreeTextMulti question is being created
			if (ID_of_edited_question == '')
				{
						var subcomponent_array = [];
						var quesID = "Q" + question_number;
						while( check_duplicate_quesID(question_number) == true )
						{
							question_number++;
							quesID = "Q" + question_number;
							console.log('Try with ' + quesID);					
						}
						console.log('Finally quesID is ' + quesID);
						question_number++;
						var quesType = FreeTextMulti_const;
						var quesLabel = [$('#FreeTextMulti_Form_QuesText').val(),$('#FreeTextMulti_Form_QuesImage').val(),$('#FreeTextMulti_Form_QuesAudio').val()];
						var subcomponent_array = [];
						
						for(var i=0;i<subcomponent_count;i++)
						  {
						  var ID = quesID + '_subcomponent_' + i;
						  console.log(ID);
						  console.log(   $('#' + ID).val()      );
						  if (  $('#' + ID).length  )
						  {
						  		if ($('#' + ID).val() != '') subcomponent_array.push(  $('#' + ID).val()  );
						  }
						  }	
						
						//Add the new FreeTextMulti to the Question_Array of the Campaign
						var temp = new FreeTextMulti(quesID, quesType, quesLabel, subcomponent_array);
						Question_Array.push(temp);
						
						addNode(quesID);
						addDefaultTransition(quesID);
						
						//reset text fields
						$('.FreeTextMulti_input').val('');
						$(".subcomponent_FreeTextMulti").remove()  ;
						
						//hide the form
						$('#FreeTextMulti_Form').hide();	
						
						//reset the variable that counts the subcomponent
						subcomponent_count = 0;
						$("#display_hide").show();	
						nodeSequence.push(quesID);
						console.log('The nodeSequence is ' + JSON.stringify(nodeSequence));
				}
			
			else
				{
					for (var i=0;i<Question_Array.length;i++)
					{
						if (Question_Array[i].getID()  == ID_of_edited_question)
							{
								console.log("Question found, data is " + Question_Array[i].getID() + ' ' + Question_Array[i].getLabel());
								Question_Array.splice(i,1);
							}
					}
					
					var subcomponent_array = [];
					var quesID = ID_of_edited_question;
					var quesType = FreeTextMulti_const;
					var quesLabel = [$('#FreeTextMulti_Form_QuesText').val(),$('#FreeTextMulti_Form_QuesImage').val(),$('#FreeTextMulti_Form_QuesAudio').val()];
					
					for(var i=0;i<subcomponent_count;i++)
					  {
					  	var ID = quesID + '_subcomponent_' + i;
					  	console.log(ID);
					  	console.log(   $('#' + ID).val()      );
					  	if (  $('#' + ID).length  )
						  {
						  		if ($('#' + ID).val() != '') subcomponent_array.push(  $('#' + ID).val()  );
						  }
					  }	
					
					//Add the new FreeTextMulti to the Question_Array of the Campaign
					var temp = new FreeTextMulti(quesID, quesType, quesLabel, subcomponent_array);
					Question_Array.push(temp);
					
					ID_of_edited_question = '';
					
					//reset text fields
					$('.FreeTextMulti_input').val('');
					$(".subcomponent_FreeTextMulti").remove()  ;
					
					//hide the form
					$('#FreeTextMulti_Form').hide();	
					
					//reset the variable that counts the subcomponent
					subcomponent_count = 0;
					$("#display_hide").show();				
				}
			$('#edit_node').hide();
		});

		$('#FreeTextMulti_addSubcomponent').on('click', function(e) {
			console.log('question_number is ' + question_number);
			//Add new subcomponent to a new FreeTextMulti
			if (ID_of_edited_question == '')
				{
					var quesID = "Q" + question_number;	
					while( check_duplicate_quesID(question_number) == true )
					{
						question_number++;
						quesID = "Q" + question_number;
						console.log('Try with ' + quesID);					
					}
					console.log('Current questionID of this FreeTextMulti is ' + quesID);
					
				}
			else
			{
				var quesID = ID_of_edited_question;	
				
			}			
				//Add a new div
				$('<div id="' + quesID + '_subcomponent_div' + subcomponent_count + '" class = "subcomponent_FreeTextMulti hover_action subcomponent" </div>').appendTo("#FreeTextMulti_innerForm");
				
				//Add text "Sub-Component" to the newly-created div
				$('<p id ="' + quesID + '_subcomponent_text_' + subcomponent_count + '" class = "subcomponent_FreeTextMulti">').text('Sub-Component').appendTo("#" + quesID + '_subcomponent_div' + subcomponent_count);
				
				//Add textfield to the newly-created div
				$('<input type="text" class = "subcomponent_FreeTextMulti" id="' + quesID + '_subcomponent_' + subcomponent_count + '"> </input>' ).appendTo("#" + quesID + '_subcomponent_div' + subcomponent_count);
				
				//Add REMOVE button to the newly-created div
				$('<button id="Delete_subcomponent_' + subcomponent_count + '" type="button" class="btn btn-danger" style="display: none;"> <span class="glyphicon glyphicon-remove-sign"></span> Remove </button>')
				.click(function(){
					
					var thisButton_ID = $(this).attr('id');
					console.log(thisButton_ID);
					var subcomponent_index = thisButton_ID.substring(thisButton_ID.lastIndexOf('_')+1, thisButton_ID.length );
					console.log(subcomponent_index);
					$('#' + quesID + '_subcomponent_div' + subcomponent_index).remove();
					//subcomponent_count--;
								              
		            })
				.appendTo("#" + quesID + '_subcomponent_div' + subcomponent_count);
				
				subcomponent_count++;	
				console.log(subcomponent_count);
				console.log(quesID);				
		});
		
		//--------------------------------------MultipleChoiceSingle-----------------------------------
		$('#MultipleChoiceSingle').on('click', function(e) {
			console.log('question_number is ' + question_number);
			$('.question').hide();
			$('.quesTrans').hide();
			$('#MultipleChoiceSingle_Form').show();
			$("#display_hide").hide();	
		});

		$('#MultipleChoiceSingle_Cancel').on('click', function(e) {
			
			//reset text fields
			$('.MultipleChoiceSingle_input').val('');
			//hide the form
			$('#MultipleChoiceSingle_Form').hide();	
			//Show the div $("#display_hide")
			$("#display_hide").show();
			$(".subcomponent_MultipleChoiceSingle").remove()  ;
			
			ID_of_edited_question = '';

		});

		$('#MultipleChoiceSingle_addSubcomponent').on('click', function(e) {
			console.log('question_number is ' + question_number);
			if (ID_of_edited_question == '')
				{
					var quesID = "Q" + question_number;	
					while( check_duplicate_quesID(question_number) == true )
					{
						question_number++;
						quesID = "Q" + question_number;
						console.log('Try with ' + quesID);					
					}
					console.log('Current questionID of this MultipleChoiceSingle is ' + quesID);
				}
			else 
				{
					var quesID = ID_of_edited_question;
				}
			
			//Add a new div
			$('<div id="' + quesID + '_subcomponent_div' + subcomponent_count + '" class = "subcomponent_MultipleChoiceSingle hover_action subcomponent" </div>').appendTo("#MultipleChoiceSingle_innerForm");
			
			//Add text "Sub-Component" to the newly-created div
			$('<p id ="' + quesID + '_subcomponent_text_' + subcomponent_count + '" class = "subcomponent_MultipleChoiceSingle">').text('Sub-Component').appendTo("#" + quesID + '_subcomponent_div' + subcomponent_count);
			
			//Add textfield to the newly-created div
			$('<input type="text" class = "subcomponent_MultipleChoiceSingle" id="' + quesID + '_subcomponent_' + subcomponent_count + '"> </input>' ).appendTo("#" + quesID + '_subcomponent_div' + subcomponent_count);
			
			//Add REMOVE button to the newly-created div
			$('<button id="Delete_subcomponent_' + subcomponent_count + '" type="button" class="btn btn-danger" style="display: none;"> <span class="glyphicon glyphicon-remove-sign"></span> Remove </button>')
			.click(function(){
				
				var thisButton_ID = $(this).attr('id');
				console.log(thisButton_ID);
				var subcomponent_index = thisButton_ID.substring(thisButton_ID.lastIndexOf('_')+1, thisButton_ID.length );
				console.log(subcomponent_index);
				$('#' + quesID + '_subcomponent_div' + subcomponent_index).remove();
				//subcomponent_count--;
							              
		        })
			.appendTo("#" + quesID + '_subcomponent_div' + subcomponent_count);
			
			subcomponent_count++;	
			console.log(subcomponent_count);
			console.log(quesID);		
		});

		$('#MultipleChoiceSingle_Save').on('click', function(e) {
			console.log('question_number is ' + question_number);
			if (ID_of_edited_question == '')
				{
						var subcomponent_array = [];
						var quesID = "Q" + question_number;
						while( check_duplicate_quesID(question_number) == true )
						{
							question_number++;
							quesID = "Q" + question_number;
							console.log('Try with ' + quesID);					
						}
						console.log('Finally quesID is ' + quesID);
						question_number++;
						var quesType = MultipleChoiceSingle_const;
						var quesLabel = [$('#MultipleChoiceSingle_Form_QuesText').val(),$('#MultipleChoiceSingle_Form_QuesImage').val(),$('#MultipleChoiceSingle_Form_QuesAudio').val()];
						
						for(var i=0;i<subcomponent_count;i++)
						  {
							  var ID = quesID + '_subcomponent_' + i;
							  console.log(ID);
							  console.log(   $('#' + ID).val()      );
							  if (  $('#' + ID).length  )
								  {
								  		if ($('#' + ID).val() != '') subcomponent_array.push(  $('#' + ID).val()  );
								  }					  
						  }	
						
						//Add the new MultipleChoiceSingle to the Question_Array of the Campaign
						var temp = new MultipleChoiceSingle(quesID, quesType, quesLabel, subcomponent_array);
						Question_Array.push(temp);
						
						addNode(quesID);
						addDefaultTransition(quesID); 
						
						//reset text fields
						$('.MultipleChoiceSingle_input').val('');
						$(".subcomponent_MultipleChoiceSingle").remove()  ;
						
						//hide the form
						$('#MultipleChoiceSingle_Form').hide();	
						
						//reset the variable that counts the subcomponent
						subcomponent_count = 0;	
						$("#display_hide").show();	
						nodeSequence.push(quesID);
						console.log('The nodeSequence is ' + JSON.stringify(nodeSequence));
				}
			else
				{
						for (var i=0;i<Question_Array.length;i++)
						{
							if (Question_Array[i].getID()  == ID_of_edited_question)
								{
									console.log("Question found, data is " + Question_Array[i].getID() + ' ' + Question_Array[i].getLabel());
									Question_Array.splice(i,1);
								}
						}
						
						var subcomponent_array = [];
						var quesID = ID_of_edited_question;
						var quesType = MultipleChoiceSingle_const;
						var quesLabel = [$('#MultipleChoiceSingle_Form_QuesText').val(),$('#MultipleChoiceSingle_Form_QuesImage').val(),$('#MultipleChoiceSingle_Form_QuesAudio').val()];
						
						for(var i=0;i<subcomponent_count;i++)
						  {
						  	var ID = quesID + '_subcomponent_' + i;
						  	console.log(ID);
						  	console.log(   $('#' + ID).val()      );
						  	if (  $('#' + ID).length  )
							  {
							  		if ($('#' + ID).val() != '') subcomponent_array.push(  $('#' + ID).val()  );
							  }
						  }	
						
						//Add the new MultipleChoiceSingle to the Question_Array of the Campaign
						var temp = new MultipleChoiceSingle(quesID, quesType, quesLabel, subcomponent_array);
						Question_Array.push(temp);
						
						ID_of_edited_question = '';
						
						//reset text fields
						$('.MultipleChoiceSingle_input').val('');
						$(".subcomponent_MultipleChoiceSingle").remove()  ;
						
						//hide the form
						$('#MultipleChoiceSingle_Form').hide();	
						
						//reset the variable that counts the subcomponent
						subcomponent_count = 0;
						$("#display_hide").show();				
				}		
		});
		
		//-------------------------------MultipleChoiceMulti----------------------------------------
		$('#MultipleChoiceMulti').on('click', function(e) {	
			console.log('question_number is ' + question_number);
			$('.question').hide();
			$('.quesTrans').hide();
			$('#MultipleChoiceMulti_Form').show();	
			$("#display_hide").hide();
		});

		$('#MultipleChoiceMulti_Cancel').on('click', function(e) {
			
			//reset text fields
			$('.MultipleChoiceMulti_input').val('');
			//hide the form
			$('#MultipleChoiceMulti_Form').hide();	
			
			$("#display_hide").show();
			$('.subcomponent_MultipleChoiceMulti').remove();
			
			ID_of_edited_question = '';

		});

		$('#MultipleChoiceMulti_addSubcomponent').on('click', function(e) {
			console.log('question_number is ' + question_number);
			if (ID_of_edited_question == '')
				{
					var quesID = "Q" + question_number;	
					while( check_duplicate_quesID(question_number) == true )
					{
						question_number++;
						quesID = "Q" + question_number;
						console.log('Try with ' + quesID);					
					}
					console.log('Current questionID of this MultipleChoiceMulti is ' + quesID);
				}
			else
				{
					var quesID = ID_of_edited_question;
				}
			
			//Add a new div
			$('<div id="' + quesID + '_subcomponent_div' + subcomponent_count + '" class = "subcomponent_MultipleChoiceMulti hover_action subcomponent" </div>').appendTo("#MultipleChoiceMulti_innerForm");
			
			//Add text "Sub-Component" to the newly-created div
			$('<p id ="' + quesID + '_subcomponent_text_' + subcomponent_count + '" class = "subcomponent_MultipleChoiceMulti">').text('Sub-Component').appendTo("#" + quesID + '_subcomponent_div' + subcomponent_count);
			
			//Add textfield to the newly-created div
			$('<input type="text" class = "subcomponent_MultipleChoiceMulti" id="' + quesID + '_subcomponent_' + subcomponent_count + '"> </input>' ).appendTo("#" + quesID + '_subcomponent_div' + subcomponent_count);
			
			//Add REMOVE button to the newly-created div
			$('<button id="Delete_subcomponent_' + subcomponent_count + '" type="button" class="btn btn-danger" style="display: none;"> <span class="glyphicon glyphicon-remove-sign"></span> Remove </button>')
			.click(function(){
				
				var thisButton_ID = $(this).attr('id');
				console.log(thisButton_ID);
				var subcomponent_index = thisButton_ID.substring(thisButton_ID.lastIndexOf('_')+1, thisButton_ID.length );
				console.log(subcomponent_index);
				$('#' + quesID + '_subcomponent_div' + subcomponent_index).remove();
				//subcomponent_count--;
							              
		        })
			.appendTo("#" + quesID + '_subcomponent_div' + subcomponent_count);
			
			subcomponent_count++;	
			console.log(subcomponent_count);
			console.log(quesID);		
		});

		$('#MultipleChoiceMulti_Save').on('click', function(e) {
			console.log('question_number is ' + question_number);
			if (ID_of_edited_question == '')
			{
					var subcomponent_array = [];
					var quesID = "Q" + question_number;
					while( check_duplicate_quesID(question_number) == true )
					{
						question_number++;
						quesID = "Q" + question_number;
						console.log('Try with ' + quesID);					
					}
					console.log('Finally quesID is ' + quesID);
					question_number++;
					var quesType = MultipleChoiceMulti_const;
					var quesLabel = [$('#MultipleChoiceMulti_Form_QuesText').val(),$('#MultipleChoiceMulti_Form_QuesImage').val(),$('#MultipleChoiceMulti_Form_QuesAudio').val()];
					
					for(var i=0;i<subcomponent_count;i++)
					  {
						  var ID = quesID + '_subcomponent_' + i;
						  console.log(ID);
						  console.log(   $('#' + ID).val()      );
						  if (  $('#' + ID).length  )
							  {
							  		if ($('#' + ID).val() != '') subcomponent_array.push(  $('#' + ID).val()  );
							  }					  
					  }	
					
					//Add the new MultipleChoiceMulti to the Question_Array of the Campaign
					var temp = new MultipleChoiceMulti(quesID, quesType, quesLabel, subcomponent_array);
					Question_Array.push(temp);
					
					addNode(quesID);
		    		addDefaultTransition(quesID); 
					
					//reset text fields
					$('.MultipleChoiceMulti_input').val('');
					$(".subcomponent_MultipleChoiceMulti").remove()  ;
					
					//hide the form
					$('#MultipleChoiceMulti_Form').hide();	
					
					//reset the variable that counts the subcomponent
					subcomponent_count = 0;	
					$("#display_hide").show();		
					nodeSequence.push(quesID);
					console.log('The nodeSequence is ' + JSON.stringify(nodeSequence));
			}
			else
				{
						for (var i=0;i<Question_Array.length;i++)
						{
							if (Question_Array[i].getID()  == ID_of_edited_question)
								{
									console.log("Question found, data is " + Question_Array[i].getID() + ' ' + Question_Array[i].getLabel());
									Question_Array.splice(i,1);
								}
						}
						
						var subcomponent_array = [];
						var quesID = ID_of_edited_question;
						var quesType = MultipleChoiceMulti_const;
						var quesLabel = [$('#MultipleChoiceMulti_Form_QuesText').val(),$('#MultipleChoiceMulti_Form_QuesImage').val(),$('#MultipleChoiceMulti_Form_QuesAudio').val()];
						
						for(var i=0;i<subcomponent_count;i++)
						  {
						  	var ID = quesID + '_subcomponent_' + i;
						  	console.log(ID);
						  	console.log(   $('#' + ID).val()      );
						  	if (  $('#' + ID).length  )
							  {
							  		if ($('#' + ID).val() != '') subcomponent_array.push(  $('#' + ID).val()  );
							  }
						  }	
						
						//Add the new MultipleChoiceMulti to the Question_Array of the Campaign
						var temp = new MultipleChoiceMulti(quesID, quesType, quesLabel, subcomponent_array);
						Question_Array.push(temp);
						
						ID_of_edited_question = '';
						
						//reset text fields
						$('.MultipleChoiceMulti_input').val('');
						$(".subcomponent_MultipleChoiceMulti").remove()  ;
						
						//hide the form
						$('#MultipleChoiceMulti_Form').hide();	
						
						//reset the variable that counts the subcomponent
						subcomponent_count = 0;
						$("#display_hide").show();				
				}		
		});
		
		//---------------------------------AudioSensor-----------------------------------
		$('#AudioSensor').on('click', function(e) {	
			console.log('question_number is ' + question_number);
			$('.question').hide();
			$('.quesTrans').hide();
			$('#AudioSensor_Form').show();
			$("#display_hide").hide();
		});

		$('#AudioSensor_Cancel').on('click', function(e) {
			
			//reset text fields
			$('.AudioSensor_input').val('');
			//hide the form
			$('#AudioSensor_Form').hide();
			$("#display_hide").show();
			$('#edit_node').hide();
			
			ID_of_edited_question = '';		
		});

		$('#AudioSensor_Save').on('click', function(e) {
			console.log('question_number is ' + question_number);
			//A new AudioSensor is created
			if (ID_of_edited_question == '')
				{
					var quesID = "Q" + question_number;
					while( check_duplicate_quesID(question_number) == true )
					{
						question_number++;
						quesID = "Q" + question_number;
						console.log('Try with ' + quesID);					
					}
					console.log('Finally quesID is ' + quesID);
					question_number++;
					var quesType = AudioSensor_const;
					var quesLabel = [$('#AudioSensor_Form_QuesText').val(),$('#AudioSensor_Form_QuesImage').val()];
					var temp = new AudioSensor(quesID, quesType, quesLabel);
					Question_Array.push(temp);		
				
					addNode(quesID);
		    		addDefaultTransition(quesID);
		  		
		 	 		//reset text fields
					$('.AudioSensor_input').val('');		
					//hide the form
					$('#AudioSensor_Form').hide();
					$("#display_hide").show();	
					nodeSequence.push(quesID);
					console.log('The nodeSequence is ' + JSON.stringify(nodeSequence));
				}
			
			//A AudioSensor is being edited, 
			else 
				{
					for (var i=0;i<Question_Array.length;i++)
						{
							if (Question_Array[i].getID()  == ID_of_edited_question)
								{
									console.log("Question found, data is " + Question_Array[i].getID() + ' ' + Question_Array[i].getLabel());
									Question_Array.splice(i,1);
								}
						}
					var quesID = ID_of_edited_question;
					var quesType = AudioSensor_const;
					var quesLabel = [$('#AudioSensor_Form_QuesText').val(),$('#AudioSensor_Form_QuesImage').val()];
					var temp = new AudioSensor(quesID, quesType, quesLabel);
					Question_Array.push(temp);
					
					ID_of_edited_question = '';
					
					//reset text fields
					$('.AudioSensor_input').val('');		
					//hide the form
					$('#AudioSensor_Form').hide();
					$("#display_hide").show();			
				}
			$('#edit_node').hide();
		});
		
		//---------------------------------TextDisplay-----------------------------------
		$('#TextDisplay').on('click', function(e) {
			$('.question').hide();
			$('.quesTrans').hide();
			$('#TextDisplay_Form').show();
			$("#display_hide").hide();
		});

		$('#TextDisplay_Cancel').on('click', function(e) {
			
			//reset text fields
			$('.TextDisplay_input').val('');
			//hide the form
			$('#TextDisplay_Form').hide();
			$("#display_hide").show();
			$('#edit_node').hide();
			
			ID_of_edited_question = '';		
		});	

		$('#TextDisplay_Save').on('click', function(e) {
			
			//A new TextDisplay is created
			if (ID_of_edited_question == '')
				{
					var quesID = "T" + question_number;
					
					while( check_duplicate_quesID(question_number) == true )
					{
						question_number++;
						quesID = "T" + question_number;
						console.log('Try with ' + quesID);					
					}
					console.log('Finally quesID is ' + quesID);
					
					question_number++;
					var quesType = TextDisplay_const;
					var quesLabel = [$('#TextDisplay_Form_QuesText').val(),$('#TextDisplay_Form_QuesImage').val(),$('#TextDisplay_Form_QuesAudio').val()];
					var temp = new TextDisplay(quesID, quesType, quesLabel);
					Question_Array.push(temp);		
				
					addNode(quesID);
		    		addDefaultTransition(quesID); 
		  		
		 	 		//reset text fields
					$('.TextDisplay_input').val('');		
					//hide the form
					$('#TextDisplay_Form').hide();
					$("#display_hide").show();
					nodeSequence.push(quesID);
					console.log('The nodeSequence is ' + JSON.stringify(nodeSequence));
				}
			
			//A TextDisplay is being edited, 
			else 
				{
					for (var i=0;i<Question_Array.length;i++)
						{
							if (Question_Array[i].getID()  == ID_of_edited_question)
								{
									console.log("Question found, data is " + Question_Array[i].getID() + ' ' + Question_Array[i].getLabel());
									Question_Array.splice(i,1);
								}
						}
					var quesID = ID_of_edited_question;
					var quesType = TextDisplay_const;
					var quesLabel = [$('#TextDisplay_Form_QuesText').val(),$('#TextDisplay_Form_QuesImage').val(),$('#TextDisplay_Form_QuesAudio').val()];
					var temp = new TextDisplay(quesID, quesType, quesLabel);
					Question_Array.push(temp);
					
					ID_of_edited_question = '';
					
					//reset text fields
					$('.TextDisplay_input').val('');		
					//hide the form
					$('#TextDisplay_Form').hide();
					$("#display_hide").show();				
				}
			
			$('#edit_node').hide();
		});
		
		//---------------------------------FreeNumericSingle-----------------------------------
		$('#FreeNumericSingle').on('click', function(e) {
			$('.question').hide();
			$('.quesTrans').hide();
			$('#FreeNumericSingle_Form').show();
			$("#display_hide").hide();
		});

		$('#FreeNumericSingle_Cancel').on('click', function(e) {
			
			//reset text fields
			$('.FreeNumericSingle_input').val('');
			//hide the form
			$('#FreeNumericSingle_Form').hide();
			$("#display_hide").show();
			$('#edit_node').hide();
			
			ID_of_edited_question = '';		
		});	

		$('#FreeNumericSingle_Save').on('click', function(e) {
			
			//A new FreeNumericSingle is created
			if (ID_of_edited_question == '')
				{
					var quesID = "Q" + question_number;
					
					while( check_duplicate_quesID(question_number) == true )
					{
						question_number++;
						quesID = "Q" + question_number;
						console.log('Try with ' + quesID);					
					}
					console.log('Finally quesID is ' + quesID);
					
					question_number++;
					var quesType = FreeNumericSingle_const;
					var quesLabel = [$('#FreeNumericSingle_Form_QuesText').val(),$('#FreeNumericSingle_Form_QuesImage').val(),$('#FreeNumericSingle_Form_QuesAudio').val()];
					var temp = new FreeNumericSingle(quesID, quesType, quesLabel);
					Question_Array.push(temp);		
				
					addNode(quesID);
		    		addDefaultTransition(quesID); 
		  		
		 	 		//reset text fields
					$('.FreeNumericSingle_input').val('');		
					//hide the form
					$('#FreeNumericSingle_Form').hide();
					$("#display_hide").show();	
					nodeSequence.push(quesID);
					console.log('The nodeSequence is ' + JSON.stringify(nodeSequence));
				}
			
			//A FreeNumericSingle is being edited, 
			else 
				{
					for (var i=0;i<Question_Array.length;i++)
						{
							if (Question_Array[i].getID()  == ID_of_edited_question)
								{
									console.log("Question found, data is " + Question_Array[i].getID() + ' ' + Question_Array[i].getLabel());
									Question_Array.splice(i,1);
								}
						}
					var quesID = ID_of_edited_question;
					var quesType = FreeNumericSingle_const;
					var quesLabel = [$('#FreeNumericSingle_Form_QuesText').val(),$('#FreeNumericSingle_Form_QuesImage').val(),$('#FreeNumericSingle_Form_QuesAudio').val()];
					var temp = new FreeNumericSingle(quesID, quesType, quesLabel);
					Question_Array.push(temp);
					
					ID_of_edited_question = '';
					
					//reset text fields
					$('.FreeNumericSingle_input').val('');		
					//hide the form
					$('#FreeNumericSingle_Form').hide();
					$("#display_hide").show();				
				}
			
			$('#edit_node').hide();
		});
		
		//---------------------------------ContRange-----------------------------------
		$('#ContRange').on('click', function(e) {
			$('.question').hide();
			$('.quesTrans').hide();
			$('#ContRange_Form').show();
			$("#display_hide").hide();
		});

		$('#ContRange_Cancel').on('click', function(e) {
			
			//reset text fields
			$('.ContRange_input').val('');
			//hide the form
			$('#ContRange_Form').hide();
			$("#display_hide").show();
			$('#edit_node').hide();
			
			ID_of_edited_question = '';		
		});	

		$('#ContRange_Save').on('click', function(e) {
			
			//A new ContRange is created
			if (ID_of_edited_question == '')
				{
					var quesID = "Q" + question_number;
					
					while( check_duplicate_quesID(question_number) == true )
					{
						question_number++;
						quesID = "Q" + question_number;
						console.log('Try with ' + quesID);					
					}
					console.log('Finally quesID is ' + quesID);
					
					question_number++;
					var quesType = ContRange_const;
					var quesLabel = [$('#ContRange_Form_QuesText').val(),$('#ContRange_Form_QuesImage').val(),$('#ContRange_Form_QuesAudio').val()];
					
					var subcomponent_array = [];
	    			subcomponent_array.push( $('#ContRange_min').val() ); //Read min value
	    			subcomponent_array.push( $('#ContRange_max').val() ); //Read max value
	    			
	    			var temp = new ContRange(quesID, quesType, quesLabel, subcomponent_array);
					Question_Array.push(temp);		
				
					addNode(quesID);
		    		addDefaultTransition(quesID); 
		  		
		 	 		//reset text fields
					$('.ContRange_input').val('');		
					//hide the form
					$('#ContRange_Form').hide();
					$("#display_hide").show();	
					nodeSequence.push(quesID);
					console.log('The nodeSequence is ' + JSON.stringify(nodeSequence));
				}
			
			//A ContRange is being edited, 
			else 
				{
					for (var i=0;i<Question_Array.length;i++)
						{
							if (Question_Array[i].getID()  == ID_of_edited_question)
								{
									console.log("Question found, data is " + Question_Array[i].getID() + ' ' + Question_Array[i].getLabel());
									Question_Array.splice(i,1);
								}
						}
					var quesID = ID_of_edited_question;
					var quesType = ContRange_const;
					var quesLabel = [$('#ContRange_Form_QuesText').val(),$('#ContRange_Form_QuesImage').val(),$('#ContRange_Form_QuesAudio').val()];
					
					var subcomponent_array = [];
	    			subcomponent_array.push( $('#ContRange_min').val() ); //Read min value
	    			subcomponent_array.push( $('#ContRange_max').val() ); //Read max value
					
	    			var temp = new ContRange(quesID, quesType, quesLabel, subcomponent_array);
					Question_Array.push(temp);
					
					ID_of_edited_question = '';
					
					//reset text fields
					$('.ContRange_input').val('');		
					//hide the form
					$('#ContRange_Form').hide();
					$("#display_hide").show();				
				}
			
			$('#edit_node').hide();
		});
		
		//---------------------------------Duplicate question
		    $('#copyQues').on('click', function(e) {
		    	var found = false;
				
				var tempID = 1;
				while( check_duplicate_quesID(tempID) == true )
					{
						tempID++;						
						console.log('Try with ' + tempID);					
					}
					console.log('Finally quesID is Q' + tempID);
				
		    	
		    			
		    		var value = $('#selection').val();
		    		for (var i = 0;i<Question_Array.length;i++)
		    			{
		    				if (Question_Array[i].getID() == value)	
		    					{
		    						found = true;
		    						console.log("Will duplicate question " + value);
		    						var selectedQuesType =  Question_Array[i].getType();
		    						
		    						switch (selectedQuesType)
		    						{
		    							case FreeTextSingle_const:
		    								
		    								var quesID = "Q" + tempID;
		    				    			tempID++;
		    								var temp = new FreeTextSingle(quesID, Question_Array[i].getType(), Question_Array[i].getLabel());
		    				    			Question_Array.push(temp);
		    				    			
		    				    			addNode(quesID);
		    				    			/*
		    				    			//Visually add the node(by default it is disconnected) to the graph
		    				      			cy.add({
		    				        	 	   group: "nodes",
		    				        	  	  data: { id: quesID },
		    				        		    //position: { x: question_number * 20 , y: question_number * 20  }
		    				        	  		position: { x: getNodePositionX() + 30 , y: getNodePositionY() + 30  }
		    				      		 	});
		    				    			*/
		    				    			
		    				    			/*
		    				      			//Add the default transition ("end transition") to the question just created
		    				     	 		var blank_condition = [];
		    				     	 		var temp_WorkflowElement = new Workflow_Element(quesID,blank_condition);
		    				    			Campaign_Workflow.push(temp_WorkflowElement);
		    				    			*/
		    				    			addDefaultTransition(quesID);
		    				    			nodeSequence.push(quesID);
		    				    			
		    				    			break;
		    				    		
		    				      		case FreeTextMulti_const:
		    				      				
		    				      			var quesID = "Q" + tempID;
			    				    		tempID++;
			    				    		var temp = new FreeTextMulti(quesID, Question_Array[i].getType(), Question_Array[i].getLabel(), Question_Array[i].getSubcomponent());
			    				    		Question_Array.push(temp);
			    				    		
			    				    		addNode(quesID);
			    				    		addDefaultTransition(quesID);
			    				    		nodeSequence.push(quesID);
			    				    		
		    				      			break;
		    				      				
										case MultipleChoiceSingle_const:
		    				      				
		    				      			var quesID = "Q" + tempID;
			    				    		tempID++;
			    				    		var temp = new MultipleChoiceSingle(quesID, Question_Array[i].getType(), Question_Array[i].getLabel(), Question_Array[i].getSubcomponent());
			    				    		Question_Array.push(temp);
			    				    		
			    				    		addNode(quesID);
			    				    		addDefaultTransition(quesID);
			    				    		nodeSequence.push(quesID);
			    				    		
		    				      			break;
		    				      			
										case MultipleChoiceMulti_const:
		    				      			
		    				      			var quesID = "Q" + tempID;
			    				    		tempID++;
			    				    		var temp = new MultipleChoiceMulti(quesID, Question_Array[i].getType(), Question_Array[i].getLabel(), Question_Array[i].getSubcomponent());
			    				    		Question_Array.push(temp);
			    				    		
			    				    		addNode(quesID);
			    				    		addDefaultTransition(quesID);
			    				    		nodeSequence.push(quesID);
			    				    		
		    				      			break;
		    				      			
										case AudioSensor_const:
		    				      			
		    				      			var quesID = "Q" + tempID;
			    				    		tempID++;
			    				    		var temp = new AudioSensor(quesID, Question_Array[i].getType(), Question_Array[i].getLabel());
			    				    		Question_Array.push(temp);
			    				    		
			    				    		addNode(quesID);
			    				    		addDefaultTransition(quesID);
			    				    		nodeSequence.push(quesID);
			    				    		
		    				      			break;
		    				      			
										case TextDisplay_const:
		    				      			
		    				      			var quesID = "T" + tempID;
			    				    		tempID++;
			    				    		var temp = new TextDisplay(quesID, Question_Array[i].getType(), Question_Array[i].getLabel());
			    				    		Question_Array.push(temp);
			    				    		
			    				    		addNode(quesID);
			    				    		addDefaultTransition(quesID);
			    				    		nodeSequence.push(quesID);
			    				    		
		    				      			break;
		    				      			
										case FreeNumericSingle_const:
		    				      			
		    				      			var quesID = "Q" + tempID;
			    				    		tempID++;
			    				    		var temp = new FreeNumericSingle(quesID, Question_Array[i].getType(), Question_Array[i].getLabel());
			    				    		Question_Array.push(temp);
			    				    		
			    				    		addNode(quesID);
			    				    		addDefaultTransition(quesID);
			    				    		nodeSequence.push(quesID);
			    				    		
		    				      			break;
		    				      			
										case ContRange_const:
		    				      			
		    				      			var quesID = "Q" + tempID;
			    				    		tempID++;
			    				    		var temp = new ContRange(quesID, Question_Array[i].getType(), Question_Array[i].getLabel(), Question_Array[i].getSubcomponent());
			    				    		Question_Array.push(temp);
			    				    		
			    				    		addNode(quesID);
			    				    		addDefaultTransition(quesID);
			    				    		nodeSequence.push(quesID);
			    				    		
		    				      			break;	    				    		
		    						}    						
		    					}
		    			}	    			
		    });
		
		//----------------------------------Question Transition - DEFAULT
		$('#default_tran').on('click', function(e) {
			
			$('.question').hide();
			$('.quesTrans').hide();

			$('#default_transition').show();
			$("#display_hide").hide();
		});

		$('#default_transition_OK').on('click', function(e) {
			var origin      = $('#default_tran_origin').val().toUpperCase();
			var destination = $('#default_tran_destination').val().toUpperCase();
			
			console.log('add a new edge');
			
			cy.add({
		  	    group: "edges",
		  	    data: { id: origin + '-' + destination, source: origin, target: destination }
		  	});
			
			var tempBranch = new Branch("true",destination);
			var condition = [];
			condition.push(tempBranch);
			
			var i;
			for (i=0;i<Campaign_Workflow.length;i++)
				{
				 	if (Campaign_Workflow[i].getQuesID() == origin) 
				 		{
				 			console.log(origin + ' is duplicated');
				 			Campaign_Workflow[i].getCondition().push(tempBranch);			 			
				 		}
				}		
			//var temp_WorkflowElement = new Workflow_Element(origin,condition);
			//Campaign_Workflow.push(temp_WorkflowElement);
			
			//reset text fields
			$('.default_tran').val('');
			//hide the div
			$('#default_transition').hide();
			
			$("#display_hide").show();
			 
		});

		$('#default_transition_Cancel').on('click', function(e) {		
			
			//reset text fields
			$('.default_tran').val('');
			//hide the div
			$('#default_transition').hide();	
			
			$("#display_hide").show();		 
		});
		
		//----------------------------------Question Transition - Conditional
		$('#conditional_tran').on('click', function(e) {
			
			$('.question').hide();
			$('.quesTrans').hide();

			$('#conditional_transition').show();
			$("#display_hide").hide();
		});

		$('#conditional_transition_Cancel').on('click', function(e) {		
			
			//reset text fields
			$('.conditional_tran').val('');
			//hide the div
			$('#conditional_transition').hide();	
			
			$("#display_hide").show();
			 
		});

		$('#conditional_transition_OK').on('click', function(e) {
			var origin      = $('#conditional_tran_origin').val().toUpperCase();
			var destination = $('#conditional_tran_destination').val();
			//var expression  = $('#conditional_tran_expression').val().toUpperCase();
			
			var expression;
				var primitive = $('input[name=primitive]:checked').val();
				//alert(primitive);
				
				if (primitive == 'value')
					{
						expression = origin + '.' + primitive + ' ' + $('#stringOperand :selected').val() + ' ' + '\'' + $('#value_parameter_0').val() + '\'';
					}
				else if (primitive == 'values')
					{
						expression = origin + '.' + primitive + '.indexOf' + '(\'' +  $('#values_parameter_0').val() + '\')' + ' > -1';	    	
					}
				else if (primitive == 'count')
					{
						expression = origin + '.' + primitive + ' ' + $('#numericOperand :selected').val() + ' ' + $('#count_parameter_0').val();
					}
	    
				alert(expression);
			
			console.log('add a new edge');
			console.log( $('#combo :selected').text() );
			
			cy.add({
		  	    group: "edges",
		  	    data: { id: origin + '-' + destination, source: origin, target: destination }
		  	});
			
			var tempBranch = new Branch(expression,destination);
			
			var i;
			for (i=0;i<Campaign_Workflow.length;i++)
				{
				 	if (Campaign_Workflow[i].getQuesID() == origin) 
				 		{
				 			console.log(origin + ' is duplicated');
				 			Campaign_Workflow[i].getCondition().push(tempBranch);			 			
				 		}
				}
			
			//reset text fields
			$('.conditional_tran').val('');
			//hide the div
			$('#conditional_transition').hide();
			
			$('input[name="primitive"]').prop('checked', false);
		    $('#value_0').css('display', 'none');
			$('#values_0').css('display', 'none');
			$('#count_0').css('display', 'none');
			
			$("#display_hide").show();		
		});
		
		
	$('#cancelOperation').on('click', function(e) {		
		
			sessionStorage.campaign = null;
			window.location.href = "dashboard.html";				 
		});
	
	//---------------------------------SAVE final changes
	$('#update').on('click', function(e) {
		
		//--------------------final print-----------------
		console.log('------------------------------final print--------------------------------');
		console.log(config.Campaign_ID);
		console.log(config.Campaign_Description);
		console.log('Onetime value ----> ' + config.onetime);
		console.log(config.expiry);
		console.log(config.startDate);
		console.log(config.endDate);
		console.log(config.geoBoolean);
		console.log(JSON.stringify(config.PoI_list));
		console.log(JSON.stringify(config.PoI_list_WebMercator));
		
		console.log(StartQues);
		console.log(JSON.stringify(Question_Array));
		console.log(JSON.stringify(Campaign_Workflow));
		console.log(userID);
		console.log(JSON.stringify(cy.json()));
		
		if (StartQues == '') alert('Start question is empty');		
		
		else
			{
				var cam = new Campaign(Campaign_ID, Campaign_Description, config.onetime, expiry, start_date, end_date, geoBoolean, config.PoI_list, config.PoI_list_WebMercator,  StartQues, Question_Array, Campaign_Workflow,  userID, cy.json());
				console.log('-------------new Campaign config');
				console.log( JSON.stringify(cam) );
				
				$.post( 	                
		                "updateCampaign.php",
		                { 
		                  data: JSON.stringify(cam),
		                  old_value: JSON.stringify(config)
		                  },
		                 
		                function(data) {
		                   
		                   alert(data);  	
		                   sessionStorage.campaign = null;
		                   window.location.href = "dashboard.html";
		                   
		                }
		             );
			}
		
	});

		
		
		
		
		
		
		
		
		
		
		
	});
	
	</script>
</head>

<body>
<br><br>
<!--Nav-->
<nav class="navbar navbar-inverse navbar-fixed-top" style="background: #4c8dc7;">
    <div class="container">
        <div class="navbar-header">
            <!--Part of left-->
            
            <div id="stepsUserAuth">
                <a class="navbar-brand" href="" title="NavApps">
                    <img src="geoc.png" alt="Geo-C" height="30px" style="display: inline">                    
                </a>
            <span class="navbar-brand steps">                  
            </span>
            </div>            
        </div>
        <!--Part of right-->
        <div id="navbar" class="navbar-collapse collapse">            
        </div><!--/.navbar-collapse -->
    </div>
</nav>         

<div class="col-lg-1">
        	<br><br>
			<button id = "FreeTextSingle"       class="btn btn-primary btn-block  button_custom_color  active" style=" white-space:normal;" data-toggle="FreeTextSingle-tooltip" title="Create a FreeTextSingle with one textfield to input text"> FreeText Single </button>
			<br><br>
			<button id = "FreeTextMulti"        class="btn btn-primary btn-block  button_custom_color  active" style=" white-space:normal;" data-toggle="FreeTextMulti-tooltip"  title="Create a FreeTextMulti with multiple textfields to input text"> FreeText Multi</button>
			<br><br>
			<button id = "MultipleChoiceSingle" class="btn btn-primary btn-block  button_custom_color  active" style=" white-space:normal;" data-toggle="MultipleChoiceSingle-tooltip" title="Create a MultipleChoiceSingle with radio buttons"> MultipleChoice Single Answer </button>
			<br><br>
			<button id = "MultipleChoiceMulti"  class="btn btn-primary btn-block  button_custom_color  active" style=" white-space:normal;" data-toggle="MultipleChoiceMulti-tooltip" title="Create a MultipleChoiceMulti with checkboxs"> MultipleChoice Multiple Answers </button>
			<br><br>
			<button id = "AudioSensor" disabled class="btn btn-primary btn-block  button_custom_color  active" style=" white-space:normal;" data-toggle="AudioSensor-tooltip" title="Create a question to measure noise"> AudioSensor </button>
			<br><br>
			<button id = "TextDisplay"          class="btn btn-primary btn-block  button_custom_color  active" style=" white-space:normal;" data-toggle="TextDisplay-tooltip" title="Create a text notice"> TextDisplay </button>		
			<br><br>
			<button id = "FreeNumericSingle"    class="btn btn-primary btn-block  button_custom_color  active" style=" white-space:normal;" data-toggle="FreeNumericSingle-tooltip" title="Create a FreeNumericSingle with one field to input numbers"> FreeNumeric Single </button>
			<br><br>
			<button id = "ContRange"    		class="btn btn-primary btn-block  button_custom_color  active" style=" white-space:normal;" data-toggle="ContRange-tooltip" title="Create a ContRange with one slider to input numbers"> ContRange </button>
			
			<br><br>
			<button id = "update"             class="btn btn-primary  btn-success active" ><b>SAVE CHANGES</b> </button>
			<br><br>
			<button id = "cancelOperation"      class="btn btn-primary  btn-danger active" ><b>CANCEL OPERATION</b> </button>
</div>

		<div class="col-lg-4">
      
      		<input class="form-control hidden" id="selection" type="text" style="width:100%;">
      
      		<!-- Form FreeTextSingle -->
      		<div id="FreeTextSingle_Form"  class = "begin_step2 question FreeTextSingle edit_form">
			<br><br>
			<form id="FreeTextSingle_innerForm" >			
				   
			  Question Label: Please type the text of the question and other parameters for this <b>FreeTextSingle</b> question <br> 
			  
			  Question Text:<br>  <input type="text" class = "FreeTextSingle_input form-control" id="FreeTextSingle_Form_QuesText" ><br>
			  Image URL:<br>      <input type="text" class = "FreeTextSingle_input form-control" id="FreeTextSingle_Form_QuesImage"><br>
			  Audio URL:<br>      <input type="text" class = "FreeTextSingle_input form-control" id="FreeTextSingle_Form_QuesAudio"><br> 
			  
			  <br><br>    
			</form>
			
			<button id = "FreeTextSingle_Save"    class="btn btn-success">  Save this Question</font>  </button>  
			<button id = "FreeTextSingle_Cancel"  class="btn btn-warning">  Cancel</font> </button>
			
			</div>
			
			<!-- Form FreeTextMulti -->
			<div id="FreeTextMulti_Form"            class = "begin_step2 question FreeTextMulti edit_form">
			<br><br>
			<form id="FreeTextMulti_innerForm">
			
			Question Label: Please type the text of the question and other parameters for this <b>FreeTextMulti</b> question <br> 
			  
			  Question Text:<br>  <input type="text" class = "FreeTextMulti_input form-control" id="FreeTextMulti_Form_QuesText"><br>
			  Image URL:<br>      <input type="text" class = "FreeTextMulti_input form-control" id="FreeTextMulti_Form_QuesImage"><br>
			  Audio URL:<br>      <input type="text" class = "FreeTextMulti_input form-control" id="FreeTextMulti_Form_QuesAudio"><br> 
			    
			</form>
			<br>
			
			<div> <button id = "FreeTextMulti_addSubcomponent" class = "btn"> Add a sub-question </button> </div>
			
			<button id = "FreeTextMulti_Save"   class="btn btn-success">  Save this Question</font>  </button>  
			<button id = "FreeTextMulti_Cancel" class="btn btn-warning">  Cancel</font> </button>			
			
			</div>
			
			<!-- Form MultipleChoiceSingle -->
			<div id="MultipleChoiceSingle_Form"     class = "begin_step2 question MultipleChoiceSingle edit_form">
			<br><br>
			<form id="MultipleChoiceSingle_innerForm">
			
			Question Label: Please type the text of the question and other parameters for this <b>MultipleChoiceSingle</b> question <br> 
			  
			  Question Text:<br>  <input type="text" class = "MultipleChoiceSingle_input form-control" id="MultipleChoiceSingle_Form_QuesText"><br>
			  Image URL:<br>      <input type="text" class = "MultipleChoiceSingle_input form-control" id="MultipleChoiceSingle_Form_QuesImage"><br>
			  Audio URL:<br>      <input type="text" class = "MultipleChoiceSingle_input form-control" id="MultipleChoiceSingle_Form_QuesAudio"><br> 
			    
			</form>
			<br>
			
			<div> <button id = "MultipleChoiceSingle_addSubcomponent" class = "btn"> Add another mutually-exclusive option </button> </div>
			
			<button id = "MultipleChoiceSingle_Save"   class="btn btn-success">  Save this Question</font>  </button>  
			<button id = "MultipleChoiceSingle_Cancel" class="btn btn-warning">  Cancel</font> </button>
			
			</div>
			
			<!-- Form MultipleChoiceMulti -->
			<div id="MultipleChoiceMulti_Form"      class = "begin_step2 question MultipleChoiceMulti edit_form">
			<br><br>
			<form id="MultipleChoiceMulti_innerForm">
			
			Question Label: Please type the text of the question and other parameters for this <b>MultipleChoiceMulti</b> question <br> 
			  
			  Question Text:<br>  <input type="text" class = "MultipleChoiceMulti_input form-control" id="MultipleChoiceMulti_Form_QuesText"><br>
			  Image URL:<br>      <input type="text" class = "MultipleChoiceMulti_input form-control" id="MultipleChoiceMulti_Form_QuesImage"><br>
			  Audio URL:<br>      <input type="text" class = "MultipleChoiceMulti_input form-control" id="MultipleChoiceMulti_Form_QuesAudio"><br> 
			    
			</form>
			<br>
			
			<div> <button id = "MultipleChoiceMulti_addSubcomponent" class = "btn"> Add another option </button> </div>
			
			<button id = "MultipleChoiceMulti_Save"   class="btn btn-success">  Save this Question</font>  </button>  
			<button id = "MultipleChoiceMulti_Cancel" class="btn btn-warning">  Cancel</font> </button>
			
			</div>
			
			<!-- Form AudioSensor -->
			<div id="AudioSensor_Form"              class = "begin_step2 question AudioSensor edit_form">
			<br><br>
			<form id="AudioSensor_innerForm" >
			
				   
			  Question Label: Please type the instruction for measuring noise in this <b>AudioSensor</b> question <br> 
			  
			  Question Text:<br>  <input type="text" class = "AudioSensor_input form-control" id="AudioSensor_Form_QuesText" > <br>
			  Image URL:<br>  <input type="text" class = "AudioSensor_input form-control" id="AudioSensor_Form_QuesImage"><br>
			   
			  
			  <br><br>    
			</form>
			
			<button id = "AudioSensor_Save"    class="btn btn-success">  Save this Question</font>  </button>  
			<button id = "AudioSensor_Cancel"  class="btn btn-warning">  Cancel</font> </button>
			
			</div>
			
			<!-- Form TextDisplay -->
			<div id="TextDisplay_Form"           class = "begin_step2 question TextDisplay edit_form">
			<br><br>
			<form id="TextDisplay_innerForm" >
			
				   
			  Question Label: Please type the text of this <b>TextDisplay</b> component <br> 
			  
			  Question Text:<br>  <input type="text" class = "TextDisplay_input form-control" id="TextDisplay_Form_QuesText" > <br>
			  Image URL:<br>      <input type="text" class = "TextDisplay_input form-control" id="TextDisplay_Form_QuesImage"><br>
			  Audio URL:<br>      <input type="text" class = "TextDisplay_input form-control" id="TextDisplay_Form_QuesAudio"><br> 
			  
			  <br><br>    
			</form>
			
			<button id = "TextDisplay_Save"    class="btn btn-success">  Save this Question</font>  </button>  
			<button id = "TextDisplay_Cancel"  class="btn btn-warning">  Cancel</font> </button>
			
			</div>
			
			<!-- Form FreeNumericSingle -->
      		<div id="FreeNumericSingle_Form"  class = "begin_step2 question FreeNumericSingle edit_form">
			<br><br>
			<form id="FreeNumericSingle_innerForm" >			
				   
			  Question Label: Please type the text of the question and other parameters for this <b>FreeNumericSingle</b> question <br> 
			  
			  Question Text:<br>  <input type="text" class = "FreeNumericSingle_input form-control" id="FreeNumericSingle_Form_QuesText" ><br>
			  Image URL:<br>      <input type="text" class = "FreeNumericSingle_input form-control" id="FreeNumericSingle_Form_QuesImage"><br>
			  Audio URL:<br>      <input type="text" class = "FreeNumericSingle_input form-control" id="FreeNumericSingle_Form_QuesAudio"><br> 
			  
			  <br><br>    
			</form>
			
			<button id = "FreeNumericSingle_Save"    class="btn btn-success">  Save this Question</font>  </button>  
			<button id = "FreeNumericSingle_Cancel"  class="btn btn-warning">  Cancel</font> </button>
			
			</div>
			
			<!-- Form ContRange -->
      		<div id="ContRange_Form"  class = "begin_step2 question ContRange edit_form">
			<br><br>
			<form id="ContRange_innerForm" >			
				   
			  Question Label: Please type the text of the question and other parameters for this <b>ContRange</b> question <br> 
			  
			  Question Text:<br>  				<input type="text" class = "ContRange_input form-control" id="ContRange_Form_QuesText" ><br>
			  Image URL:<br>      				<input type="text" class = "ContRange_input form-control" id="ContRange_Form_QuesImage"><br>
			  Audio URL:<br>      				<input type="text" class = "ContRange_input form-control" id="ContRange_Form_QuesAudio"><br>
			  
			  <b>Minimum value</b> of the range:<br>	<input type="text" class = "ContRange_input form-control" id="ContRange_min"><br> 
			  <b>Maximum value</b> of the range:<br>	<input type="text" class = "ContRange_input form-control" id="ContRange_max"><br>
			  
			  <br><br>    
			</form>
			
			<button id = "ContRange_Save"    class="btn btn-success">  Save this Question</font>  </button>  
			<button id = "ContRange_Cancel"  class="btn btn-warning">  Cancel</font> </button>
			
			</div>
			
			<!-- Default Transition form -->
			<div id="default_transition"            class = "begin_step2 quesTrans edit_form">
			<br><br>  
			<form id="default_transition_form"  action="">
			Please type/select the ID of the origin and destination question
			
			<br>
			Origin question:        <br>  <input type="text" class = "default_tran form-control" id="default_tran_origin"><br>
			Destination Question:   <br>  <input type="text" class = "default_tran form-control" id="default_tran_destination"><br> 
			
			</form>
			
			<button id = "default_transition_OK"    class="btn btn-success">  OK </font>  </button>  
			<button id = "default_transition_Cancel"  class="btn btn-warning">  Cancel</font> </button>
			</div>
			
			<!-- Conditional Transition form -->
			<div id="conditional_transition"        class = "begin_step2 quesTrans edit_form">
			<br><br>  
			<form id="conditional_transition_form"  action="">
			Please type/select the ID of the origin and destination question
			
			<br>
			Origin question:        <br>  <input type="text" class = "conditional_tran form-control" id="conditional_tran_origin"><br>
			<!-- The logical expression  <br>  <input type="text" class = "conditional_tran form-control" id="conditional_tran_expression"><br> -->
			
			<form id="conditional">
				<input id='' name='primitive' type='radio' value="value" />value
				<br />
				<input id='' name='primitive' type='radio' value="values" />values
				<br />
				<input id='' name='primitive' type='radio' value="count" />count
			</form>
			<br>

				<!-- The parameter of primitive VALUE -->
				<div id='value_0' style='display:none'>
					<select id="stringOperand">  
						  <option value="==">is</option>
						  <option value="!=">is not</option>
							  
					</select>
					<input type="textbox" id="value_parameter_0">
				</div>

				<!-- The parameter of primitive VALUES -->
				<div id='values_0' style='display:none'>
					contains 
					<input type="textbox" id="values_parameter_0">
				</div>

				<!-- The parameter of primitive COUNT -->
				<div id='count_0' style='display:none'>

					<select id="numericOperand">  
						  <option value=">">></option>
						  <option value=">=">>=</option>
						  <option value="==">=</option>		  
					</select>
					
					<input type="textbox" id="count_parameter_0">
					
				</div>
			
			<br>
			Destination Question:   <br>  <input type="text" class = "conditional_tran form-control" id="conditional_tran_destination"><br> 
			
			</form>
			
			<button id = "conditional_transition_OK"    class="btn btn-success">  OK   </button>  
			<button id = "conditional_transition_Cancel"  class="btn btn-warning" style="white-space:normal;">  Cancel</button>
			</div>
			
      <!-- End of col-lg-4 -->  
      </div>
      
<div class="col-lg-1">
      		<br><br>
			<button id = "default_tran"     class="btn btn-primary  btn-block button_custom_color active" style="white-space:normal;" > Default Transition </button>
			<br><br>
			<button id = "conditional_tran" class="btn btn-primary  btn-block button_custom_color active" style="white-space:normal;"> Conditional Transition </button>
			<br><br>        
</div>

<div class="col-lg-6">
      
		<br><br>
        <!-- graph : start -->
        <div class="panel panel-primary">
          <div class="panel-heading" style="background-color: #4c8dc7;">Graph Area</div>
          <div class="panel-body">
            <div id="cy"></div>
            <br>
          </div>
          
          <button id = "new_delete" class="btn btn-danger    " > Delete </button>
        <button id = "new_selectStart" class="btn     " > Select as starting question </button>
		<button id = "copyQues" class="btn btn-primary     " > Duplicate question </button>
        </div>
        <!-- graph : end -->

</div>  

</body>

</html>